document.addEventListener('DOMContentLoaded',()=>{initUI();setupEventListeners();renderUI();observeScrollElements();});function initUI(){const topicSelect=document.getElementById('topic-select');const taskTopicSelect=document.getElementById('task-topic');Object.entries(state.topics).forEach(([id,topic])=>{const opt=document.createElement('option');opt.value=id;opt.textContent=topic.name;topicSelect.appendChild(opt);const opt2=document.createElement('option');opt2.value=id;opt2.textContent=topic.name;taskTopicSelect.appendChild(opt2);});}function setupEventListeners(){const addTopicBtn=document.getElementById('add-topic-btn');const topicInput=document.getElementById('topic-input');const topicSelect=document.getElementById('topic-select');const addSubtopicBtn=document.getElementById('add-subtopic-btn');const subtopicInput=document.getElementById('subtopic-input');const subtopicSelect=document.getElementById('subtopic-select');const taskForm=document.getElementById('task-form');const themeToggle=document.getElementById('theme-toggle');addTopicBtn.addEventListener('click',()=>{const name=topicInput.value.trim();if(!name)return alert('Enter topic name');addTopic(name);topicInput.value='';renderUI();});topicSelect.addEventListener('change',()=>{state.selectedTopicId=topicSelect.value||null;updateTaskSelects();renderStats();renderUI();});addSubtopicBtn.addEventListener('click',()=>{if(!state.selectedTopicId)return alert('Select a topic first');const name=subtopicInput.value.trim();if(!name)return alert('Enter subtopic name');addSubtopic(state.selectedTopicId,name);subtopicInput.value='';renderUI();});subtopicSelect.addEventListener('change',()=>{state.selectedSubtopicId=subtopicSelect.value||null;renderStats();});taskForm.addEventListener('submit',e=>{e.preventDefault();const title=document.getElementById('task-title').value.trim();const topicId=document.getElementById('task-topic').value;const subtopicId=document.getElementById('task-subtopic').value;const dueDate=document.getElementById('task-date').value;if(!title||!topicId||!subtopicId)return alert('Fill all fields');addTask({title,topicId,subtopicId,dueDate});taskForm.reset();renderUI();});themeToggle.addEventListener('click',()=>{state.theme=state.theme==='dark'?'light':'dark';saveState();document.body.classList.toggle('dark');themeToggle.textContent=state.theme==='dark'?'üåô Dark':'‚òÄÔ∏è Light';});}function updateTaskSelects(){const taskTopicSelect=document.getElementById('task-topic');const taskSubtopicSelect=document.getElementById('task-subtopic');taskSubtopicSelect.innerHTML='<option value="">Select Subtopic</option>';const topicId=taskTopicSelect.value;if(topicId&&state.topics[topicId]){Object.entries(state.topics[topicId].subtopics).forEach(([id,sub])=>{const opt=document.createElement('option');opt.value=id;opt.textContent=sub.name;taskSubtopicSelect.appendChild(opt);});}}function renderUI(){updateTopicsList();updateTasksList();renderStats();}function updateTopicsList(){const select=document.getElementById('topic-select');const selected=select.value;select.innerHTML='<option value="">-- Choose a Topic --</option>';Object.entries(state.topics).forEach(([id,topic])=>{const opt=document.createElement('option');opt.value=id;opt.textContent=topic.name;if(id===selected)opt.selected=true;select.appendChild(opt);});document.getElementById('task-topic').innerHTML='<option value="">Select Topic</option>';Object.entries(state.topics).forEach(([id,topic])=>{const opt=document.createElement('option');opt.value=id;opt.textContent=topic.name;document.getElementById('task-topic').appendChild(opt);});}function updateTasksList(){const container=document.getElementById('tasks-container');const topicId=state.selectedTopicId;const subtopicId=state.selectedSubtopicId;let tasks=state.tasks;if(topicId)tasks=tasks.filter(t=>t.topicId===topicId);if(subtopicId)tasks=tasks.filter(t=>t.subtopicId===subtopicId);if(tasks.length===0){container.innerHTML='<p class="empty-state">No tasks. Create one above! üöÄ</p>';return;}container.innerHTML=tasks.map(task=>{const date=task.dueDate?new Date(task.dueDate).toLocaleDateString():'No date';return`<div class="task-item ${task.done?'done':''}"><input type="checkbox" ${task.done?'checked':''} class="task-checkbox" onchange="toggleTaskDone('${task.id}');renderUI();"><div class="task-details"><p class="task-title">${task.title}</p><p class="task-meta">Due: ${date} | ${task.done?'‚úì Completed':'‚è≥ Pending'}</p></div><button class="task-delete" onclick="deleteTask('${task.id}');renderUI();">Delete</button></div>`;}).join('');}function renderStats(){const global=getGlobalStats();const globalPercentFill=document.getElementById('global-progress-fill');globalPercentFill.style.width=global.percent+'%';document.getElementById('global-percentage').textContent=global.percent+'%';document.getElementById('global-completed').textContent=global.done;document.getElementById('global-pending').textContent=global.pending;document.getElementById('global-total').textContent=global.total;const topicId=state.selectedTopicId;if(topicId){const topic=getTopicStats(topicId);document.getElementById('topic-stats-container').style.display='block';document.getElementById('subtopic-section').style.display='block';document.getElementById('subtopic-select-section').style.display='block';document.getElementById('topic-name-display').textContent=state.topics[topicId].name;document.getElementById('topic-percentage').textContent=topic.percent+'%';document.getElementById('topic-completed').textContent=topic.done;document.getElementById('topic-pending').textContent=topic.pending;const subtopicId=state.selectedSubtopicId;if(subtopicId){const sub=getSubtopicStats(topicId,subtopicId);document.getElementById('subtopic-stats-container').style.display='block';document.getElementById('subtopic-name-display').textContent=state.topics[topicId].subtopics[subtopicId].name;document.getElementById('subtopic-percentage').textContent=sub.percent+'%';document.getElementById('subtopic-completed').textContent=sub.completed;document.getElementById('subtopic-pending').textContent=sub.total-sub.completed;}else{document.getElementById('subtopic-stats-container').style.display='none';}updateSubtopicSelects();}else{document.getElementById('topic-stats-container').style.display='none';document.getElementById('subtopic-section').style.display='none';document.getElementById('subtopic-select-section').style.display='none';}document.getElementById('task-topic').addEventListener('change',updateTaskSelects);}function updateSubtopicSelects(){const topicId=state.selectedTopicId;const subtopicSelect=document.getElementById('subtopic-select');subtopicSelect.innerHTML='<option value="">-- Choose a Subtopic --</option>';if(topicId){Object.entries(state.topics[topicId].subtopics).forEach(([id,sub])=>{const opt=document.createElement('option');opt.value=id;opt.textContent=sub.name;subtopicSelect.appendChild(opt);});}}function observeScrollElements(){const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('in-view');observer.unobserve(entry.target);}});},{threshold:0.2});document.querySelectorAll('.reveal-on-scroll').forEach(el=>{observer.observe(el);});}
